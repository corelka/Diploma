<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />


    <title>@ViewBag.Title</title>
    <link href="~/lib/fullcalendar/dist/fullcalendar.css" rel="stylesheet" />
    <link href="~/lib/jquery-ui/themes/base/jquery-ui.css" rel="stylesheet" />
    <!--<link rel="stylesheet" href="http://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">-->
    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="~/lib/jquery-ui/jquery-ui.js"></script>
    <script src="~/lib/moment/moment.js"></script>
    <script src="~/lib/fullcalendar/dist/fullcalendar.js"></script>
   <!--<script src="http://code.jquery.com/jquery-1.10.2.js"></script>--> 
    <!--<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>-->
    <style>        
          .table {
              list-style-type: none; 
              margin: 0; 
              float: left; 
              margin-right: 10px; 
              background: #eee; 
              padding: 5px; 
              width: 143px;
          }
          .issue {
              margin: 5px; 
              padding: 5px;
              width: 120px;
          }
          .popup {
              margin:40px auto 0px auto;
              width:730px;
              height: auto;
              padding:10px;
              background-color: #c5c5c5;
              border-radius:5px;
              box-shadow: 0px 0px 10px #000;
          }

          .overlay{
              width:100%;
              min-height:100%;
              background-color: rgba(0,0,0,0.5);
              overflow:hidden;
              position:fixed;
              top:0px;
          }
    </style>
    <script>
        $(document).ready(function () {
            PopUpHide();
            $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek,agendaDay'
                },
                defaultDate: '2016-01-12',
                editable: true,
                eventLimit: true, // allow "more" link when too many events
                events: [
                    {
                        title: 'All Day Event',
                        start: '2016-01-01'
                    },
                    {
                        title: 'Long Event',
                        start: '2016-01-07',
                        end: '2016-01-10'
                    },
                    {
                        id: 999,
                        title: 'Repeating Event',
                        start: '2016-01-09T16:00:00'
                    },
                    {
                        id: 999,
                        title: 'Repeating Event',
                        start: '2016-01-16T16:00:00'
                    },
                    {
                        title: 'Conference',
                        start: '2016-01-11',
                        end: '2016-01-13',
                        editable: false
                    },
                    {
                        title: 'Meeting',
                        start: '2016-01-12T10:30:00',
                        end: '2016-01-12T12:30:00'
                    },
                    {
                        title: 'Lunch',
                        start: '2016-01-12T12:00:00'
                    },
                    {
                        title: 'Meeting',
                        start: '2016-01-12T14:30:00'
                    },
                    {
                        title: 'Happy Hour',
                        start: '2016-01-12T17:30:00'
                    },
                    {
                        title: 'Dinner',
                        start: '2016-01-12T20:00:00'
                    },
                    {
                        title: 'Birthday Party',
                        start: '2016-01-13T07:00:00'
                    },
                    {
                        title: 'Click for Google',
                        url: 'http://google.com/',
                        start: '2016-01-28'
                    }
                ]
            });
        });
        function PopUpShow(window) {
            console.log(window);
            $(".overlay").show();
            $('#'+window).show();
            $(".issue").attr("style","position:inherit;");
        }
        function PopUpHide() {
            $(".overlay").hide();
            $(".popup").hide();
            //$("#window_change").hide();
            //$("#create_issue").hide();
            $(".issue").attr("style", "position:relative;");
        }
        $(function() {
        //$(".table").sortable({ revert: true });
            $(".table").droppable({
                drop: function (event, ui) {
                    var prev = $(ui.draggable).parent().attr("id");
                    var next = $(this).attr("id");
                    console.log(prev);
                    console.log(next);
                    $(ui.draggable).detach().css({ top: 0, left: 0 }).appendTo(this);
                    if (prev != next)                        
                        $.post(
                            "/Dashboard/MoveIssue",
                            {
                                tableID: $(this).attr('id').substring(2),
                                issueID: ui.draggable.attr('id').substring(2)
                            });
                    //console.log($(this).attr('id').substring(2));
                    //console.log(ui.draggable.attr('id').substring(2));
                    }
                });

        $(".issue").draggable({
            cursor: "move",
            connectToSortablle: "ul.table",
            revert: "invalid"
        });

        $(".issue").disableSelection();

        $(".AddIssue").click(function () {
            $("#window_create").find("input[name=tableId]").attr("value", $(this).closest("ul").attr("id").substring(2));
            PopUpShow("window_create");
        })
        
        $(".issue").click(function () {
            var inp = $(this).find("p");
            $("#window_change").find("input[name=tableId]").attr("value", $(this).closest("ul").attr("id").substring(2));
            $("#window_change").find("input[name=id]").attr("value", $(this).attr("id").substring(2));
            $("#window_change").find("input[name=name]").attr("value", inp[0].textContent);
            $("#window_change").find("input[name=description]").attr("value", inp[1].textContent);
            $("#window_change").find("input[name=comments]").attr("value", inp[2].textContent);
            PopUpShow("window_change");
            //$("#window_change").attr("style", "display:block;");
      });
  });
    </script>
</head>
<body>
    <a asp-controller="Home" asp-action="Index">Home Page</a>
    <br>
    <br>
    @if (User.Identity.IsAuthenticated)
    {
        <div>
            Hello, @User.Identity.Name!
        </div>
        <div>
            <a asp-controller="Account" asp-action="Logout">Logout</a>
        </div>
        <div>
            <a asp-controller="Account" asp-action="ChangeProfile">Change Profile info</a>
        </div>
    }
    else
    {
        <div>
            <a asp-controller="Account" asp-action="Login">Login</a>
        </div>
        <div>
            <a asp-controller="Account" asp-action="Register">Register</a>
        </div>
    }
    <br>

    <div>
        @RenderBody()
    </div>

</body>
</html>
